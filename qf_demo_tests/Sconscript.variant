import os

Import('env')
Import('name')

# mods = env.SConscript('./src/Sconscript', exports = 'env', variant_dir='./build/' + name)

sources = Glob('./tests/*.c')
sources.extend(Glob('./tests/*.cpp'))

sources.extend(Glob('./tests/*/*.c'))
sources.extend(Glob('./tests/*/*.cpp'))

sources.extend(Glob('./platform_' + name + 's/*.c'))
sources.extend(Glob('./platform_' + name + 's/*.cpp'))

sources.extend(Glob('./platform_' + name + 's/*/*.c'))
sources.extend(Glob('./platform_' + name + 's/*/*.cpp'))

map_file = Dir('../').path + '/qf_demo_' + name + '.map'

env.Append(LINKFLAGS = ['-Xlinker', '-Map=' + map_file])

Depends ('./tests/*.o', env['O_DEPS'])
Depends ('./tests/*/*.o', env['O_DEPS'])
Depends ('./platform_' + name + 's/*.o', env['O_DEPS'])
Depends ('./platform_' + name + 's/*/*.o', env['O_DEPS'])

exes = env.Program(['../qf_demo_' + name, map_file], sources)
exe = {'exe': exes[0], 'map': exes[1]}
Return('exe')

# print Dir('./').abspath
# print env.GetBuildPath(sources)
